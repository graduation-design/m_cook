"use strict";function addUploader(){var e=Android.getUploader();$("#form").append('<input name="uploader" value="'+e+'" type="hidden"/>')}function addTags(){var e=$(".tags").val().trim().replace(/ +/g," "),t=[],n=[],a="";""!==e&&(t=e.split(" ").sort());for(var i=0;i<t.length;i++)t[i]!==t[i+1]&&n.push(t[i]);n.forEach(function(e){a+='<input type="hidden" name="food_class" value="'+e+'"/>'}),$("#form").append($(a))}function bindMaterialEvent(){var e=$(".food_material");$(".material .add").on("click",function(){addMaterial()}),e.on("click",".delete",function(t){1!==e.find("li").length&&$(t.target).parents("li").remove()}),e.on("blur","li",function(e){$(e.currentTarget).find(".delete").fadeOut()}),e.on("focus","li",function(e){$(e.currentTarget).find(".delete").fadeIn()})}function bindStepEvent(){var e=$(".food-step");e.on("focus",".step-text",function(e){$(e.target).siblings(".btn").fadeIn()}),e.on("blur",".step-text",function(e){$(e.target).siblings(".btn").fadeOut()}),e.on("click",".add",function(e){addStep($(e.target).parents("li"))}),e.on("click",".delete",function(e){deleteStep($(e.target).parents("li"))})}function addMaterial(){var e='<li class="one_material">    <input name="food_name" placeholder="如 鸡蛋" class="one_piece">    <input name="food_quantity" placeholder="如 一个" class="amount_material">    <span class="fontawesome-minus-sign delete"></span>    </li>';$(".food_material").append(e)}function addStep(e){var t='<li class="each-step">\n    <div class="step-pic">\n    <span class="fontawesome-camera"></span>\n    <img src="#" class="pic_placeholder"/>\n    <input class="file_selector" type="file" accept="image/*"/>\n    </div>\n    <div class="step-num">1</div>\n    <textarea name="step_content" rows="5" class="step-text"></textarea>\n    <div class="btn">\n    <div class="fontawesome-minus-sign delete"></div>\n    <div class="fontawesome-plus-sign add"></div>\n    </div>\n    </li>';$(t).insertAfter(e),resetStepNum()}function deleteStep(e){$(".each-step").length<=1||(e.remove(),resetStepNum())}function resetStepNum(){for(var e=$(".step .step-num"),t=0;t<e.length;t++)$(e[t]).text(t+1)}function imgUpload(e,t){var n=new FormData,a=0;"main_pic_selector"!==e.attr("id")&&(a=e.parents("li").index()+1),readURL(e[0],e.siblings(".pic_placeholder")),console.log(e),n.append("uuid",t),n.append("index",a),n.append("img",e[0].files[0]),$.ajax({url:$("#J_pic_upload_url").val(),type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(e,t,n){}})}function readURL(e,t){if(e.files&&e.files[0]){var n=new FileReader;n.onload=function(e){t.attr("src",e.target.result),t.css("display","block")},n.readAsDataURL(e.files[0])}}$(function(){var e=0,t=$("#form");$.getJSON($("#J_uuid_url").val(),function(t){$("#uuid").val(t.uuid),e=t.uuid}),$(document).on("change",".file_selector",function(t){var n=$(t.target);return console.log("tgt",n),0===e?(alert("初始化失败"),void n.val("")):void imgUpload(n,e)}),t.on("submit",function(){addUploader(),addTags()}),bindMaterialEvent(),bindStepEvent()});